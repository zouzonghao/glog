document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("save-btn"),t=document.getElementById("content"),s=document.getElementById("post-id"),o=document.querySelector(".editor-actions a.open-post-link"),l=()=>{let l="0"===s.value,d=""===t.value.trim();l?(e.textContent="\uD83D\uDCBE 保存文章",e.disabled=d,e.style.opacity=d?"0.5":"1",e.style.borderColor="",e.style.color=""):(e.disabled=!1,e.style.opacity="1",d?(e.textContent="\uD83D\uDDD1️ 删除文章",e.style.borderColor="#cb2a42",e.style.color="#cb2a42"):(e.textContent="\uD83D\uDCBE 保存文章",e.style.borderColor="",e.style.color="")),l?o.classList.add("disabled"):o.classList.remove("disabled")};t.addEventListener("input",l),l(),e.addEventListener("click",function(e){e.preventDefault();let t=document.getElementById("published_at"),d=t.value;if(!/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/.test(d)){showNotification("发布时间格式不正确，应为 YYYY-MM-DD HH:mm","error");return}let n=document.getElementById("app-form"),r=new FormData(n);fetch(n.action,{method:"POST",body:new URLSearchParams(r)}).then(e=>e.json()).then(e=>{let t="info";if("success"===e.status){if(t="success","0"===s.value&&e.post_id){s.value=e.post_id;let d=`/admin/editor?id=${e.post_id}`;history.pushState({path:d},"",d)}e.slug&&(o.href=`/post/${e.slug}`),l()}else"deleted"===e.status?(t="success",setTimeout(()=>{window.location.href="/admin"},1500)):("error"===e.status||"locked"===e.status)&&(t="error");showNotification(e.message,t)}).catch(e=>{console.error("保存错误：",e),showNotification("保存时发生错误，请检查网络！","error")})})});