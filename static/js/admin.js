document.addEventListener("DOMContentLoaded",function(){let e=document.querySelector(".post-list-body");e&&(e.addEventListener("focusin",function(e){if(e.target.classList.contains("delete-wrapper")){let t=e.target,s=t.querySelector(".delete-confirm");s.classList.add("disabled"),setTimeout(()=>{s.classList.remove("disabled")},1e3)}}),e.addEventListener("click",function(e){let t=e.target;if(t.classList.contains("delete-confirm")&&!t.classList.contains("disabled")){let s=t.dataset.id;fetch(`/admin/delete/${s}`,{method:"POST"}).then(e=>e.json()).then(e=>{if("success"===e.status){showNotification(e.message,"success");let s=t.closest(".post-list-item");s&&s.remove()}else showNotification(e.message,"error")}).catch(e=>{console.error("删除失败:",e),showNotification("删除文章时出错！","error")})}}));let t=document.getElementById("select-all-posts"),s=document.querySelectorAll(".post-checkbox"),n=document.getElementById("batch-delete-btn"),c=document.getElementById("batch-set-private-btn"),a=document.getElementById("batch-set-public-btn"),i=document.getElementById("modal-confirm-btn"),d=null,l=!1;function r(){return Array.from(s).filter(e=>e.checked).map(e=>parseInt(e.dataset.id,10))}function o(){let e=r().length>0;n&&(n.disabled=!e),c&&(c.disabled=!e),a&&(a.disabled=!e)}async function h(){let e=r();if(0===e.length){showNotification("请至少选择一篇文章。","info");return}try{let t=await fetch("/admin/posts/batch-update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:e,action:d,is_private:l})}),s=await t.json();"success"===s.status?(showNotification(s.message,"success"),setTimeout(()=>window.location.reload(),1e3)):showNotification(s.message,"error")}catch(n){console.error("批量操作失败:",n),showNotification("批量操作时出错！","error")}finally{if("delete"===d){let c=document.getElementById("modal-container");c&&c.classList.remove("show")}}}t&&s.length>0&&(t.addEventListener("change",function(){s.forEach(e=>{e.checked=t.checked}),o()}),s.forEach(e=>{e.addEventListener("change",function(){this.checked?Array.from(s).every(e=>e.checked)&&(t.checked=!0):t.checked=!1,o()})})),n&&(setupGlobalModal("modal-container","batch-delete-btn"),n.addEventListener("click",()=>{d="delete"})),i&&i.addEventListener("click",h),c&&c.addEventListener("click",()=>{d="set-private",l=!0,h()}),a&&a.addEventListener("click",()=>{d="set-private",l=!1,h()})});