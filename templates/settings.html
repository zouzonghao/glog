{{define "title"}}ç«™ç‚¹è®¾ç½®{{end}}

{{define "content"}}
<div class="setting-header">
    <h2 class="group-title">ç«™ç‚¹è®¾ç½®</h2>
</div>

<form id="settings-form" action="/settings" method="POST" class="app-form">
    <div class="settings-form-group" style="margin-top: 1.5rem;">
        <label for="password">ç®¡ç†å‘˜å¯†ç </label>
        <input type="password" id="password" name="password" placeholder="ç•™ç©ºåˆ™ä¸ä¿®æ”¹" autocomplete="new-password">
    </div>

    <div class="settings-form-group">
        <label for="site_logo">ç«™ç‚¹ Logo URL</label>
        <input type="text" id="site_logo" name="site_logo" value="{{ .site_logo }}">
    </div>

    <div class="settings-form-group">
        <label for="site_title">ç«™ç‚¹æ ‡é¢˜</label>
        <input type="text" id="site_title" name="site_title" value="{{ .site_title }}">
    </div>

    <div class="settings-form-group">
        <label for="site_description">ç«™ç‚¹æè¿°</label>
        <input type="text" id="site_description" name="site_description" value="{{ .site_description }}">
    </div>

    <div class="settings-form-group">
        <label for="openai_base_url">OpenAI Compatible Base URL</label>
        <input type="text" id="openai_base_url" name="openai_base_url" value="{{ .openai_base_url }}">
    </div>

    <div class="settings-form-group">
        <label for="openai_token">OpenAI Compatible Token</label>
        <input type="password" id="openai_token" name="openai_token" placeholder="ç•™ç©ºåˆ™ä¸ä¿®æ”¹" autocomplete="new-password">
    </div>

    <div class="settings-form-group">
        <label for="openai_model">OpenAI Compatible æ¨¡å‹</label>
        <input type="text" id="openai_model" name="openai_model" value="{{ .openai_model }}">
    </div>

    <div class="settings-form-group">
        <a href="#" id="test-ai-btn">ğŸš€ æµ‹è¯•è¿æ¥</a>
    </div>

 

    <div class="editor-actions">
        <a href="#" id="save-settings-btn">ğŸ’¾ ä¿å­˜è®¾ç½®</a>
    </div>
</form>
{{end}}

{{define "scripts"}}
<script>
// AJAX for saving settings
document.getElementById('save-settings-btn').addEventListener('click', function(event) {
    event.preventDefault();

    const form = document.getElementById('settings-form');
    const formData = new FormData(form);

    fetch(form.action, {
        method: 'POST',
        body: new URLSearchParams(formData)
    })
    .then(response => response.json())
    .then(data => {
        showNotification(data.message, data.status);

        if (data.status === 'success') {
            document.getElementById('password').value = '';
            document.getElementById('openai_token').value = '';
        }
    })
    .catch(error => {
        console.error('è¡¨å•æäº¤é”™è¯¯ï¼š', error);
        showNotification('ä¿å­˜æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼', 'error');
    });
});

// AJAX for testing AI connection
document.getElementById('test-ai-btn').addEventListener('click', function(event) {
    event.preventDefault();
    const baseURL = document.getElementById('openai_base_url').value;
    const token = document.getElementById('openai_token').value;
    const model = document.getElementById('openai_model').value;
    const testBtn = this;

    showNotification('æµ‹è¯•ä¸­...', 'info');
    testBtn.style.pointerEvents = 'none'; // Disable link
    testBtn.style.opacity = '0.5';

    const formData = new URLSearchParams();
    formData.append('openai_base_url', baseURL);
    formData.append('openai_token', token);
    formData.append('openai_model', model);

    fetch('/settings/test-ai', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        showNotification(data.message, data.status);
    })
    .catch(error => {
        console.error('AI æµ‹è¯•é”™è¯¯ï¼š', error);
        showNotification('æµ‹è¯•è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–åå°æ—¥å¿—ï¼', 'error');
    })
    .finally(() => {
        testBtn.style.pointerEvents = 'auto'; // Re-enable link
        testBtn.style.opacity = '1';
    });
});
</script>
{{end}}