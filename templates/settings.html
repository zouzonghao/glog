{{define "title"}}站点设置{{end}}

{{define "content"}}
<div class="setting-header">
    <h2 class="group-title">站点设置</h2>
</div>

<form id="settings-form" action="/settings" method="POST" class="app-form">
    <div class="settings-form-group" style="margin-top: 1.5rem;">
        <label for="password">管理员密码</label>
        <input type="password" id="password" name="password" placeholder="留空则不修改" autocomplete="new-password">
    </div>

    <div class="settings-form-group">
        <label for="site_logo">站点 Logo URL</label>
        <input type="text" id="site_logo" name="site_logo" value="{{ .site_logo }}">
    </div>

    <div class="settings-form-group">
        <label for="site_title">站点标题</label>
        <input type="text" id="site_title" name="site_title" value="{{ .site_title }}">
    </div>

    <div class="settings-form-group">
        <label for="site_description">站点描述</label>
        <input type="text" id="site_description" name="site_description" value="{{ .site_description }}">
    </div>

    <div class="settings-form-group">
        <label for="openai_base_url">OpenAI Compatible Base URL</label>
        <input type="text" id="openai_base_url" name="openai_base_url" value="{{ .openai_base_url }}">
    </div>

    <div class="settings-form-group">
        <label for="openai_token">OpenAI Compatible Token</label>
        <input type="password" id="openai_token" name="openai_token" placeholder="留空则不修改" autocomplete="new-password">
    </div>

    <div class="settings-form-group">
        <label for="openai_model">OpenAI Compatible 模型</label>
        <input type="text" id="openai_model" name="openai_model" value="{{ .openai_model }}">
    </div>

    <div class="settings-form-group">
        <a href="#" id="test-ai-btn">🚀 测试连接</a>
    </div>

 

    <div class="editor-actions">
        <a href="#" id="save-settings-btn">💾 保存设置</a>
    </div>
</form>
{{end}}

{{define "scripts"}}
<script>
// AJAX for saving settings
document.getElementById('save-settings-btn').addEventListener('click', function(event) {
    event.preventDefault();

    const form = document.getElementById('settings-form');
    const formData = new FormData(form);

    fetch(form.action, {
        method: 'POST',
        body: new URLSearchParams(formData)
    })
    .then(response => response.json())
    .then(data => {
        showNotification(data.message, data.status);

        if (data.status === 'success') {
            document.getElementById('password').value = '';
            document.getElementById('openai_token').value = '';
        }
    })
    .catch(error => {
        console.error('表单提交错误：', error);
        showNotification('保存时发生错误，请检查网络连接！', 'error');
    });
});

// AJAX for testing AI connection
document.getElementById('test-ai-btn').addEventListener('click', function(event) {
    event.preventDefault();
    const baseURL = document.getElementById('openai_base_url').value;
    const token = document.getElementById('openai_token').value;
    const model = document.getElementById('openai_model').value;
    const testBtn = this;

    showNotification('测试中...', 'info');
    testBtn.style.pointerEvents = 'none'; // Disable link
    testBtn.style.opacity = '0.5';

    const formData = new URLSearchParams();
    formData.append('openai_base_url', baseURL);
    formData.append('openai_token', token);
    formData.append('openai_model', model);

    fetch('/settings/test-ai', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        showNotification(data.message, data.status);
    })
    .catch(error => {
        console.error('AI 测试错误：', error);
        showNotification('测试请求失败，请检查网络或后台日志！', 'error');
    })
    .finally(() => {
        testBtn.style.pointerEvents = 'auto'; // Re-enable link
        testBtn.style.opacity = '1';
    });
});
</script>
{{end}}